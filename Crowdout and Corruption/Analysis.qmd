---
title: "Crowd-out and Competition: How non-governmental development programs shape public spending"
author: "Blaine Finstein"
format:
   pdf:
      documentclass: article
editor: source
latex_engine: xelatex
bibliography: crowdout.bib
link-citations: true
---

# Abstract

Foreign aid and intergovernmental transfers have been shown to crowd out public spending, but non-governmental development assistance is also fungible. Additionally, empirical analyses yield mixed results. How do politicians allocate limited funds amidst non-governmental development programs, and what explains variation? I argue that while non-governmental development assistance substitutes for public spending, political competition dampens the incentive to shirk. I test these intuitions in the context of a randomized evaluation of a World Bank community development program in the Philippines, showing that non-governmental aid lowers public spending when political competition is low, and that competition shapes human development outcomes. I also exploit supervised learning to explore budget reallocation and find that aid lowers taxes and increases discretionary public sector employment. While my results imply that crowd-out is significantly more pervasive than previously believed, I demonstrate that political institutions can mitigate the perverse economic incentives induced by aid. This clarifies a conflicting body of research and provides powerful evidence to policymakers who wish to maximize the impact of development assistance.

\clearpage

# 1 Introduction

International aid agencies spend billions of dollars yearly on development assistance, providing disaster relief, building schools and infrastructure, and establishing public health programs.[^1] Such spending translates into valuable improvements in human development: microcredit can help the poor to start or expand small businesses (@banerjee2015); cash transfer programs can encourage school enrollment and mitigate child labor (@baird2014; @kabeer2015); and biometric interventions for public services can reduce ghost beneficiaries and afford governments valuable cost savings (@gelb2013).

[^1]: The Organization of Economic Cooperation and Development reports that \$214 billion was spent on official development assistance in 2023. This marks nearly a 30% increase in the last three years.

However, aid can bear pernicious consequences for the regions to which it is delivered. It can crowd out government labor, funneling top candidates into the NGO sector (@deserranno2020). It can provide politicians programs for which they can claim credit and reap electoral rewards (@cruz2017). It can also hamper long-run development when aid agencies face incentives to produce programs with demonstrable short-term impacts (@riddell2016). Evidence garnered within the context of a particular development program can fail to capture its downstream consequences and broader institutional effects, limiting our judgment about its impact.

Development programs also afford citizens necessary services that the government might otherwise need to address. If students receive textbooks from the Peace Corps, the department of education does not need to purchase them. If Relief International provides shelter and material relief following a destructive typhoon, a federal disaster response agency does not need to do so. While a benevolent government may leverage such programs to free up funds for additional social programs or reallocate them to portions of the budget that are stretched thin, others may use development programs as an opportunity to shirk.

Literature on the fungibility of aid has extensively documented that intergovernmental grants and official development assistance can crowd out public spending (@feyzioglu1998). However, development programs shift politicians' incentives even when aid is not given to the government. Regardless of the source, development aid substitutes for government service provision. Even when development programs achieve precisely the outcomes that policymakers intend for their participants, they may also allow politicians to reduce valuable public service spending that might otherwise have been released. Thus, non-governmental development assistance may diminish public programs, offering citizens the same extent of support but outsourced to aid agencies that subsume the burden.

How do politicians allocate limited resources in response to non-governmental development programs? I explore this question in the context of a randomized evaluation of a World Bank community development program in the Philippines, comparing public spending in municipalities that were and were not selected to receive funding. I begin by developing a theoretical intuition for state service substitution, drawing on crowding theory and the flypaper effect to model the political economy of local service delivery. I then consider politicians' allocation of public funds, exploring the incentives that drive the decision to maintain or pull back service provision. In particular, I explore the effect of electoral competition, showing how re-election incentives can encourage politicians to maintain public service spending.

I leverage a randomized controlled trial (RCT) in which World Bank community development assistance was allocated to citizen committees in randomly selected municipalities in order to test these implications empirically and identify causal effects on municipal-level government spending. I find strong evidence that World Bank assistance reduced state spending in the same domains and that this reduction was not offset by increases elsewhere in the budget. I then incorporate municipal election returns data and show that these effects are moderated by electoral competition. Finally, I develop supervised learning models to examine whether treatment produced additional effects on broader municipal spending and identify how funds may be reallocated. I offer evidence that non-governmental development programs lower taxes and increase casual government employment, a discretionary spending category linked to patronage rewards.

This paper contributes to an ongoing debate as to whether development assistance complements or crowds out state spending. Empirical social scientists have explored this question across countries and grant programs and reached conflicting conclusions, but there have been limited attempts to theorize these heterogeneous findings. I demonstrate that political context, electoral competition in particular, moderates public spending decisions and determines whether aid will induce a crowd-out effect. These results offer critical insight to policymakers. Understanding when and where aid might reduce public service provision ensures that development agencies can target their programs to avoid perverse political incentives and achieve the best possible outcomes for beneficiaries.

Furthermore, few studies on aid fungibility offer credible causal evidence. Grants are rarely randomly allocated and researchers must rely on quasi-experimental methods to infer causation. Given that aid agencies target their programs to underdeveloped and low-resourced regions which may spend differently on development, research designs with credible causal identification are crucial. Looking at the effects of development programs on public spending from an RCT specifically allows me to disentangle the natural association of where development agencies work from the effect of their work on political institutions. My work also offers a novel methodological contribution, applying advances in machine learning to examine if and how governments reallocate fungible funds.

This study is the first to my knowledge to employ data generated via random assignment to show that aid can crowd out public spending and to explain variation therein. In addition, it is the first to recognize that non-governmental development programs also substitute for public spending. This is important not only because it implies that crowd-out is significantly more pervasive than previously believed, but also because it demonstrates that non-governmental development programs shape the allocation of public resources. Evaluating the impact of development interventions thus requires careful consideration of the public service economy in which they are implemented. While programs may achieve their intended benefits, downstream reductions in public spending may bear consequences for human welfare.

# 2 Theory

Throughout the developing world, public institutions and aid agencies offer similar services to a limited population of overlapping beneficiaries. Villages receive water purification or electrification projects installed by an NGO while people in other parts of the country enjoy clean drinking water and electricity provided by a government utilities system. Children are inoculated in UNICEF vaccination drives while enrolled in a government health insurance scheme. Teenagers attend remedial reading classes or mathematics tutoring sessions taught by a Peace Corps volunteer at their local public school while teachers lead courses in these subjects down the hall.

Such resources are vital supplements to public service provision without which many governments would be unable to meet the needs of their citizens. However, they might also reduce demand for government services. Constituents who already have their needs met do not need to compel their elected representatives to provide them. While voters might hold under-performing incumbents accountable, aid agencies contract the performance gap. Voters might also fail to distinguish between public and private programs, rewarding politicians for aid agency services (@cruz2017). Development programs thus create a perverse political incentive to shirk. Without sanctions, politicians can reduce public service provision and expect to stay in office.

Economists have long argued that grants crowd out public spending. Following an influx of resources, governments should reduce their own spending in order to lower taxes or shift funds to discretionary categories. However, this intuition has not always borne out empirically, and there have been limited attempts to explain this variation.

This paper explores the conditions under which the economic logic for substitution fractures. Why does aid crowd out public spending in some contexts and not others? I argue that political incentives, electoral competition in particular, shape the decision to substitute development assistance for public spending. While politicians in less competitive districts can diminish public programs and expect to stay in power, those facing electoral competition must maintain service provision in order to win re-election.

This section proceeds as follows. I begin by reviewing the theoretical economic motivation by which aid should crowd out public spending and offer a brief survey of studies that evaluate this relationship empirically. I then explore how political competition drives public spending, drawing on literature on political business cycles, in particular.

## Crowd-out or crowd-in

The allocation of public resources involves trade-offs. Governments operate under budget constraints, and funding is finite. Money spent in one domain necessitates less in others. However, grants shift budgetary incentives. When funds are given for a particular purpose, the opportunity cost of spending for that purpose is reduced and politicians should move funds to portions of the budget for which the opportunity cost is higher. Thus, aid is often theorized to "crowd out" public resources that would otherwise have been spent, rendering it lost to substitution.

The economic intuition for substitution has been developed over a number of contributions, notably in the context of intergovernmental grants and fiscal federalism. @oates1972 argues that such grants are fungible and viewed by lower levels of government as additional income which may be used to reduce their own spending on targeted programs. @bradford1971 employ the median voter theorem to predict that transfers will have a limited impact on public goods access. Citizens might prefer that additional funds reduce the tax burden rather than increase public services, and given that levels of public spending are determined by the median voter in a representative democracy, politicians should allocate funds accordingly when localities receive grants. @zampelli1986 argues that governments seek to maximize discretionary resources and can shift budgets accordingly through grant funding without increasing overall spending.

Substitution has been documented empirically in various contexts, from American federal to state transfers, to foreign aid, to non-profits and other non-governmental agencies. From panel data on 67 countries spanning 1972-2000, @chatterjee2012 find that approximately 70 percent of total aid is fungible. Evaluating the effect of official development assistance (ODA) on tax collection in 118 countries, @benedek2014 find a negative relationship, but that the effect diminishes over time in response to efforts to mobilize public revenue collection. They also find that the effect is particularly stark for poorer countries and those with weak institutions.

The empirical findings, however, are inconclusive. Grants appear to substitute for government spending in many contexts, but complement it in others. This has been documented perhaps most significantly in a broad array of studies that provide evidence for the "flypaper effect", that money tends to stick where it lands. Observed originally by @hines1995, American intergovernmental grants tend to increase public spending much more than equivalent increases in local revenue. In contrast to economic theory, this "anomaly" sees local governments spend a disproportionately large share of grants rather than treating them as fungible income.

Crowd-in is not just a feature of American intergovernmental grants alone. @dahlberg2008 leverage discontinuity in the Swedish federal grant system to demonstrate that these funds crowd-in local government spending and fail to reduce local tax revenue. @masaki2018 extends these findings to the developing world, documenting that intergovernmental transfers mobilize local revenue collection in Tanzania. In the Philippine context, @troland2016 finds that intergovernmental grants increased local government spending per federal dollar. These single-country studies are substantiated by cross-country panel data which also find evidence for a crowd-in effect (@remmer2004).

## Politics and public spending

Why is it that aid seems to substitute for public spending in some contexts but complement it in others? Considering the political incentives that moderate public spending decisions sheds light on this discrepancy and clarifies a conflicting body of research.

Electoral incentives shape public spending. This can be observed particularly starkly in the context of political business cycles. Economic policies and macroeconomic outcomes correspond to electoral cycles. Incumbents leverage expansionary policies before elections in order to reduce unemployment, stimulate growth, and improve their chances of reelection (@nordhaus1975). Voters face an information asymmetry about the competence of politicians and must judge candidates on the basis of short-term economic performance (@rogoff1988). Political business cycles have been documented particularly profusely in developing country contexts where institutions are weak (@brender2005; @shi2006), and have been found in municipal Philippine government spending (@labonne2016).

Political competition heightens electoral incentives and promotes public service provision. @harding2014 find that countries with stronger electoral competition spend more on primary education and have higher enrollment rates. @Burgess2015 find that Kenyan districts with greater competition receive more road infrastructure investments than those where incumbents face little competition. @ferraz2011 find that electoral competition increases public goods provision and lowers corruption in Brazilian municipalities.

I argue that political competition also determines whether politicians leverage foreign aid to reduce public service provision. Incumbents must win re-election, and those in competitive districts need to win voters' favor. While aid offers an opportunity to shirk, politicians facing competition must maximize their electoral chances and maintain service provision.

# 3 Data

Established in 2003, Kapit-bisig Laban sa Kahirapan ("Linking Arms Against Poverty") -- Comprehensive and Integrated Delivery of Social Services (Kalahi-CIDSS) aims to reduce poverty and increase local participatory governance in the Philippines. Financed by a number of agencies, including the World Bank, Millennium Challenge Corporation, and a matching grant from local governments themselves, the program assigns grants to qualifying municipalities[^2] that are distributed directly to citizen committees for community development projects. Particular projects are determined by communities themselves and include the construction of farm-to-market roads, establishing health stations, encouraging school enrollment, developing footpaths, and building small-scale irrigation and drainage systems, among others.

[^2]: Municipal poverty rate is the predominant qualification for Kalahi-CIDSS. In the Philippines, municipalities are rated on a class scale of 1 (wealthiest) to 6 (poorest). In order to receive Kalahi-CIDSS, 4th -- 6th class municipalities must have a poverty incidence above the national average of 26.5%, based on the 2009 Small Area Estimates (SAE) of the National Statistical Coordination Board (NSCB). 1st -- 3rd class municipalities qualify if they have a poverty incidence of 40% or higher (@dswd2024).

From 2011-2015, Innovations for Poverty Action (IPA) conducted an impact evaluation of Kalahi-CIDSS aiming to evaluate the effects of the program on key socioeconomic and governance outcomes via a randomized controlled trial (RCT). The impact evaluation spanned 198 municipalities across all three of the main island groups of the Philippines (Luzon, the Visayas, and Mindanao). While the exact timing of grant allocation varied, municipalities selected for treatment received one grant per year from 2013-2015. These were calculated per municipality on the basis of its number of barangays, the smallest administrative unit in the Philippines and the level at which citizen committees were organized. While all barangays in a participating municipality were eligible to receive Kalahi-CIDSS, funds were allotted in accordance with project priorities.[^3] In addition to financing local development projects, Kalahi-CIDSS trains community members and local governments in choosing, designing, and implementing projects.

[^3]: For a detailed review of selection criteria for the IPA impact evaluation, see @beatty2018. More information on project priorities and funds allocation within a given municipality can be found on the website of the Department of Social Welfare and Development (DSWD) of the Philippines, the federal agency that administers Kalahi-CIDSS (@dswd2024).

Kalahi-CIDSS was found to have statistically significant impacts on several socioeconomic outcomes. Road improvements reduced the time to key services and the cost to get farm products to market, water projects reduced the time and cost to obtain water, and education projects increased school enrollments (@beatty2018). Kalahi affected local politics as well. Other research outside of the impact evaluation sample has found that Kalahi-CIDSS increased incumbent vote share (@cruz2017).

I evaluate effects of Kalahi-CIDSS on quarterly public spending among the IPA impact evaluation sample for the quarters through which grants were given to all treated municipalities (third quarter 2013 through second quarter 2015). Data on local government spending are obtained from the Bureau of Local Government Finance of the Philippines. Data on the IPA impact evaluation of Kalahi-CIDSS are publicly available through the Millennium Challenge Corporation Evidence Platform of the ICPSR (@ipa2019). Grant allocation years and other qualitative information on implementation of the randomized controlled trial are derived from the third round impact evaluation report (@beatty2018). Data on municipalities included in the impact evaluation affected by Typhoon Yolanda are obtained from the Kalahi-CIDSS supplementary documentation from the Asian Development Bank (@asiandevelopmentbank). I merge these data with 2013 municipal election returns published by the Commission on Elections of the Philippines (COMELEC), which are the local election results immediately preceding the intervention. In addition to these data sources, I obtain and merge quarterly labor force surveys from the Philippine Statistics Authority (PSA).

Each municipality in the Philippines completes a standardized table to document quarterly expenditures. This table contains a number of categories and the amount spent per category in Philippine pesos. In order to determine the impact of Kalahi-CIDSS on public spending in the same domains for which Kalahi-CIDSS provided funds, I code total spending in key project categories. These include "education, culture, sports, and manpower development", "health, nutrition, population control", "housing and community development", "social services and social welfare", and "general public services".

While some amount of discretion is required in order to categorize budget categories as within or outside of the realm of barangay-level Kalahi projects, my coding scheme is conservative and includes all spending categories that at least partially overlap with Kalahi. For example, Kalahi did not provide funds for culture and sports, but did so for education and manpower development, and so I label the entire budget category as Kalahi-related service provision. This should bias effect sizes downwards - expenditures for which Kalahi should not substitute are included in my key outcome variable.

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Load packages
library(tidyverse)
library(modelsummary)
library(randomForest)
library(ggplot2)
library(caret)
library(pROC)
library(gt)
library(kableExtra)
library(tidyr)
library(readxl)
library(estimatr)
library(sf)

# Load and clean Kalahi replication data to match budgets to treat and control
matching_dat <- read_csv("Data/KALAHI/PHL-KC Matching Data for Sample/matching data for sample.csv") |> 
  mutate(reg_psgc = case_when(
    reg_psgc == "IV-A" ~ "Calabarzon",
    reg_psgc == "V" ~ "Bicol",
    reg_psgc == "CAR" ~ "Cordillera Administrative Region",
    reg_psgc == "IV-B" ~ "Mimaropa",
    reg_psgc == "IX" ~ "Zamboanga",
    reg_psgc == "VI" ~ "Western Visayas",
    reg_psgc == "VII" ~ "Central Visayas",
    reg_psgc == "VIII" ~ "Eastern Visayas",
    reg_psgc == "X" ~ "Northern Mindanao",
    reg_psgc == "XI" ~ "Davao",
    reg_psgc == "XII" ~ "SOCCSKSARGEN",
    .default = "Caraga"
  )) |> 
  rename(lgu = mun, region = reg_psgc, treat = treatment) |> 
  dplyr::select(island, region, lgu, treat, pi, bgytot, pop07nso, land) |> 
  mutate(lgu = case_when(
    lgu == "Villa Viciosa" ~ "Villaviciosa",
    lgu == "Catarman (CAPITAL)" ~ "Catarman",
    lgu == "General Macarthur" ~ "General MacArthur",
    lgu == "Macarthur" ~ "MacArthur",
    lgu == "Brooke's point" ~ "Brooke's Point",
    lgu == "El Nido (Bacuit)" ~ "El Nido",
    lgu == "Romblon (CAPITAL)" ~ "Romblon",
    lgu == "Lau-an" ~ "Lau An",
    lgu == "Tobias Fornier (Dao)" ~ "Tobias Fornier",
    lgu == "Ipil (CAPITAL)" ~ "Ipil",
    lgu == "Roseller Lim" ~ "R. T. Lim",
    lgu == "Licuan-Baay (Licuan)" ~ "Baay Licuan",
    lgu == "Asuncion (Saug)" ~ "Asuncion",
    lgu == "Lambayong (Mariano Marcos)" ~ "Lambayang",
    lgu == "Santa monica (Sapao)" ~ "Santa Monica",
    lgu == "San Francisco (Anao-aon)" ~ "San Francisco",
    lgu == "Lau-an" ~ "Lau An",
    lgu == "Anini-y" ~ "Anini Y",
    .default = lgu)) |> 
  arrange(region, lgu)

matching_dat[155, 3] <- "Sofronio Espanola"

# Create binary variable for Yolanda damage and add to Kalahi data
yolanda <- c("Gumaca", "Lopez", "General Nakar", "Tagkawayan", "Mauban", "San Antonio", "Real",
             "Alabat", "General Luna", "Padre Burgos", "Quezon", "Agdangan", "Montevista",
             "Pantukan") |> 
  append(as.character(as.matrix(subset(matching_dat, region == "Mimaropa", select = lgu)))) |> 
  append(as.character(as.matrix(subset(matching_dat, region == "Bicol", select = lgu)))) |> 
  append(as.character(as.matrix(subset(matching_dat, region == "Western Visayas", select = lgu)))) |>
  append(as.character(as.matrix(subset(matching_dat, region == "Central Visayas", select = lgu)))) |>
  append(as.character(as.matrix(subset(matching_dat, region == "Eastern Visayas", select = lgu)))) |>
  append(as.character(as.matrix(subset(matching_dat, region == "Caraga", select = lgu))))

matching_dat <- matching_dat |> mutate(yolanda = ifelse(lgu %in% yolanda, 1, 0))

## Create political vars

# Function to process a single Excel file for vote share calculation
process_single_file <- function(file_path) {
  
  # Extract the region name from the second-level folder in the path
  path_parts <- str_split(file_path, "/", simplify = TRUE)
  region <- ifelse(length(path_parts) >= 2, path_parts[length(path_parts) - 2], NA)
  region <- str_replace_all(region, "REGION ", "")
  region <- str_replace_all(region, "C.A.R.", "CAR")
  region <- str_replace_all(region, "^\\d+$", as.character(as.roman(region)))
  region <- str_replace_all(region, "4A", "IV-A")
  region <- str_replace_all(region, "4B", "IV-B")
  province <- ifelse(length(path_parts) >= 2, path_parts[length(path_parts) - 1], NA)
  
  # Check if the sheet "MAYOR" exists
  sheet_names <- excel_sheets(file_path)

  # Read the mayor sheet
  if ("MAYOR" %in% sheet_names) {
  mayor_data <- read_excel(file_path, sheet = "MAYOR")
} else if ("Mayor" %in% sheet_names) {
  mayor_data <- read_excel(file_path, sheet = "Mayor")
} else {
  return(NULL)
}
  
  # Exclude metadata columns to identify vote columns
  metadata_cols <- c("Region", "Province", "Municipality/City", "Barangay", "Precinct Code",
                     "Actual Voters Voted", "Contest Name")
  vote_columns <- setdiff(colnames(mayor_data), metadata_cols)
  
  # Ensure vote columns exist
  if (length(vote_columns) == 0) {
    warning(sprintf("No vote data found in file %s.", file_path))
    return(NULL)
  }
  
  summarized_votes <- mayor_data |> 
  dplyr::select(all_of(vote_columns)) |> 
  mutate(across(everything(), ~ as.numeric(gsub(",", "", .)))) |>   # remove commas, convert to numeric
  summarize(across(everything(), sum, na.rm = TRUE)) |> 
  pivot_longer(everything(), names_to = "candidate", values_to = "votes")
  
  # Calculate total votes and vote share
  total_votes <- sum(mayor_data$"Actual Voters Voted", na.rm = T)
  if (total_votes == 0) {
    warning(sprintf("No votes recorded in file %s.", file_path))
    return(NULL)
  }
  
  summarized_votes <- summarized_votes |> 
    mutate(vote_share = votes / total_votes) |> 
    arrange(desc(vote_share))
  
  # Extract the winner and handle cases with no runner-up
  winner <- summarized_votes[1, ]
  runner_up <- if (nrow(summarized_votes) > 1) summarized_votes[2, ] else data.frame(candidate = NA,
                                                                                     votes = 0,
                                                                                     vote_share = 0)
  
  # Calculate vote difference
  vote_diff <- winner$vote_share - runner_up$vote_share
  
  # Format municipality name to proper case
  mun <- str_to_title(tools::file_path_sans_ext(basename(file_path)))
  
  data.frame(
    region = region,
    mun = mun,
    winner = winner$candidate,
    uncontested = ifelse(is.na(runner_up$candidate), 1, 0),
    vote_share = winner$vote_share,
    vote_diff = vote_diff
  )
}

# Function to process all files in a folder and its subdirectories
process_mayoral_results <- function(folder_path) {
  # List all Excel files in the folder and its subdirectories
  excel_files <- list.files(folder_path, full.names = TRUE, recursive = TRUE)
  results <- lapply(excel_files, process_single_file)
  bind_rows(results)
}

# Process files and ensure no duplicate lgu names to avoid multiple matches upon join
election_returns <- process_mayoral_results("Data/Elections")

## Create quarterly spending data

process_quarterly <- function(file_path, sheet_name = NULL) {
  data <- read_excel(file_path, sheet = sheet_name, col_names = FALSE)
  
  # Identify the last cell with text in the first 5 rows
  column_names <- data[1:10, ]|> 
    as.data.frame() |> 
    summarise_all(~ last(na.omit(.))) |> 
    unlist()
  
  # Clean column names
  cleaned_column_names <- column_names |> 
    str_to_lower() |> 
    str_replace_all(" ", "_") |> 
    str_replace_all("/", "_") |> 
    str_replace_all("[^a-z_]", "") |> 
    str_replace_all("_+", "_")
  
  # Set the new column names, eliminate the first 5 rows, and clean municipality names
  cleaned_data <- data[-(1:10), ] |> 
    setNames(cleaned_column_names) |> 
    filter(lgu_type == "Municipality") |> 
    dplyr::select(-c(lgu_type)) |> 
    rename(mun = lgu_name) 
  cleaned_data <- cleaned_data |> 
    mutate(across(4:ncol(cleaned_data), as.numeric)) |> 
    mutate(quarter = str_match(sheet_name, "Q[1-4]20[0-1][0-9]")[, 1],
           year = str_match(sheet_name, "20[0-1][0-9]")[, 1],
           .before = general_fund) |>
    mutate(kalahi_spending = rowSums(across(c(education_culture_sports_manpower_development,
                                              health_nutrition_population_control,
                                              housing_and_community_development,
                                              social_services_and_social_welfare,
                                              general_public_services)),
                                     na.rm = TRUE),
           total_spending = rowSums(across(c(total_current_operating_expenditures,
                                             total_nonoperating_expenditures,
                                             total_nonincome_receipts)),
                                    na.rm = TRUE),
           .before = general_fund) |> 
    mutate(region = str_replace_all(str_replace_all(region, "Region ", ""), " Region", "")) |>
    mutate(region = str_replace_all(region, "MIMAROPA", "IV-B")) |> 
    mutate(mun = ifelse(grepl("Sofronio", mun), "Sofronio Espanola", mun)) |> 
    mutate(mun = ifelse(grepl("Roseller", mun), "Roseller Lim", mun)) |> 
    mutate(mun = ifelse(grepl("Villaviciosa", mun), "Villa Viciosa", mun)) |> 
    mutate(mun = ifelse(grepl("Brooke", mun), "Brooke's Point", mun))
  
  return(cleaned_data)
}

# Read in and clean data
dat <- process_quarterly("Data/Quarterly Spending/SRE-QTR-2013.xlsx", sheet = "Q12013") |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2013.xlsx", sheet = "Q22013")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2013.xlsx", sheet = "Q32013")) |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2013.xlsx", sheet = "Q42013")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2014.xlsx", sheet = "Q12014")) |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2014.xlsx", sheet = "Q22014")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2014.xlsx", sheet = "Q32014")) |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2014.xlsx", sheet = "Q42014")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2015.xlsx", sheet = "Q12015")) |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2015.xlsx", sheet = "Q22015")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2015.xlsx", sheet = "Q32015")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2015.xlsx", sheet = "Q42015")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2009.xlsx", sheet = "Q12009")) |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2009.xlsx", sheet = "Q22009")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2009.xlsx", sheet = "Q32009")) |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2009.xlsx", sheet = "Q42009")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2010.xlsx", sheet = "Q12010")) |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2010.xlsx", sheet = "Q22010")) |> 
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2010.xlsx", sheet = "Q32010")) |>
  rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2010.xlsx", sheet = "Q42010"))
  # rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2011.xlsx", sheet = "Q12011")) |>
  # rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2011.xlsx", sheet = "Q22011")) |> 
  # rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2011.xlsx", sheet = "Q32011")) |> 
  # rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2011.xlsx", sheet = "Q42011")) |> 
  # rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2012.xlsx", sheet = "Q12012")) |>
  # rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2012.xlsx", sheet = "Q22012")) |> 
  # rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2012.xlsx", sheet = "Q32012")) |> 
  # rbind(process_quarterly("Data/Quarterly Spending/SRE-QTR-2012.xlsx", sheet = "Q42012"))

# Merge w covariates
dat <- read_csv("Data/KALAHI/PHL-KC Matching Data for Sample/matching data for sample.csv") |> 
  rename(region = reg_psgc, treat = treatment) |> 
  mutate(mun = gsub(" \\(.*$", "", iconv(mun, from = "", to = "UTF-8", sub = "byte"))) |> 
  mutate(mun = ifelse(grepl("Sofronio", mun), "Sofronio Espanola", mun)) |> 
  dplyr::select(-c(island, mun_psgc, pairnum)) |> 
  group_by(region, mun) |> 
  filter(n() == 1) |> 
  ungroup() |> 
  left_join(dat, by = c("region", "mun")) |> 
  filter(!is.na(treat)) |> 
  mutate(kalahi_spending_percap = kalahi_spending / pop07nso,
           total_spending_percap = total_spending / pop07nso,
           .before = general_fund)

# Merge in vote share data
dat <- election_returns |>
  group_by(region, mun) |> 
  filter(n() == 1) |> 
  ungroup() |> 
  right_join(dat, by = c("region", "mun")) |> 
  mutate(eightieth_margin = ifelse(vote_diff > .8, 1, 0),
         seventyfifth_margin = ifelse(vote_diff > .75, 1, 0),
         seventieth_margin = ifelse(vote_diff > .7, 1, 0),
         sixtyfifth_margin = ifelse(vote_diff > .65, 1, 0),
         sixtieth_margin = ifelse(vote_diff > .6, 1, 0),
         fiftyfifth_margin = ifelse(vote_diff > .55, 1, 0),
         fiftieth_margin = ifelse(vote_diff > .5, 1, 0),
         fortyfifth_margin = ifelse(vote_diff > .45, 1, 0),
         fortieth_margin = ifelse(vote_diff < .40, 1, 0),
         thirtyfifth_margin = ifelse(vote_diff < .35, 1, 0),
         thirtieth_margin = ifelse(vote_diff < .30, 1, 0),
         twentyfifth_margin = ifelse(vote_diff < .25, 1, 0),
         twentieth_margin = ifelse(vote_diff < .2, 1, 0),
         fifteenth_margin = ifelse(vote_diff < .15, 1, 0),
         tenth_margin = ifelse(vote_diff < .1, 1, 0),
         fifth_margin = ifelse(vote_diff < .05, 1, 0),
         marginal_margin = ifelse(vote_diff < .025, 1, 0),
         yolanda = ifelse(mun %in% yolanda &
                            (as.numeric(substr(quarter, 3, 6)) > 2013 |
                            quarter == "Q42013"), 1, 0),
         .before = treat) |> 
  mutate(
    post = ifelse(as.numeric(substr(quarter, 3, 6)) >= 2013, 1, 0),
    post_treat = treat * post,
    .before = treat)
```

```{r}
# PH local gov interactive data set

localgov <- read_xlsx("Data/fiscal_data_revised_for upload.xlsx") |> 
  filter(lgutype == "Province" & year == 2010) |> 
  rename(province = lgu, voteshare = pi) |> 
  mutate(province = str_to_title(province)) |> 
  mutate(region = case_when(
    region == "CALABARZON" ~ "IV-A",
    region == "Bicol Region" ~ "V",
    region == "CAR" ~ "CAR",
    region == "MIMAROPA" ~ "IV-B",
    region == "Zamboanga Peninsula" ~ "IX",
    region == "Western Visayas" ~ "VI",
    region == "Central Visayas" ~ "VII",
    region == "Eastern Visayas" ~ "VIII",
    region == "Northern Mindanao" ~ "X",
    region == "Davao Region" ~ "XI",
    region == "SOCCSKSARGEN" ~ "XII",
    region == "CARAGA" ~ "XIII",
    region == "BARMM" ~ "BARMM",
    region == "Ilocos Region" ~ "I",
    region == "Cagayan Valley" ~ "II",
    region == "Central Luzon" ~ "III",
    .default = "NCR"
  )) |> 
  select(-year)


# Merge dat w provincial competition
t <- localgov |>
  group_by(region, province) |> 
  filter(n() == 1) |> 
  ungroup() |> 
  right_join(dat, by = c("region", "province"))

# 2007 cesi data
creditclaim <- read_dta("Data/credit claiming/ajps_data.dta") |> 
  mutate(province = str_to_title(provincename), mun = str_to_title(municityname)) |> 
  select(-provincename, -municityname)

# Merge dat
t <- creditclaim |>
  group_by(province, mun) |> 
  filter(n() == 1) |> 
  ungroup() |> 
  right_join(dat, by = c("province", "mun"))
```


Balance on pre-treatment covariates is presented in Table 1, including mean, standard deviation, and p-value from randomization inference. Randomization inference was conducted by simulating 100 random assignments consistent with the procedure employed in the impact evaluation to compute randomization-based p-values for overall and individual covariate balance. Neither the overall p-value nor the p-values of any individual covariates are statistically significant at conventional levels ($p<.05$).

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Merge in historic budget data

process_yearly <- function(file_path) {
  data <- read_excel(file_path)
  
  # Clean column names
  cleaned_column_names <- colnames(data) |> 
    str_to_lower() |> 
    str_replace_all(" ", "_") |> 
    str_replace_all("/", "_") |> 
    str_replace_all("[^a-z_]", "") |> 
    str_replace_all("_+", "_") |> 
    str_replace_all("social_security_social_services_welfare", "social_services_and_social_welfare")
  
  # Set the new column names
  cleaned_data <- setNames(data, cleaned_column_names) |> 
    filter(lgu_type == "Municipality") |> 
    select(-c(lgu_type)) |> 
    rename(mun = lgu_name)
  
  cleaned_data <- cleaned_data |> 
    mutate(across(4:ncol(cleaned_data), as.numeric)) |>
    mutate(year = str_match(file_path, "20[0-2][0-9]")[, 1],
           .after = mun) |> 
    mutate(region = str_replace_all(str_replace_all(region, "Region ", ""), " Region", "")) |>
    mutate(region = str_replace_all(region, "MIMAROPA", "IV-B")) |> 
        mutate(kalahi_spending = rowSums(across(c(education_culture_sports_manpower_development,
                                              health_nutrition_population_control,
                                              housing_and_community_development,
                                              social_services_and_social_welfare)),
                                     na.rm = TRUE),
          total_spending = ifelse(as.numeric(year) < 2009,
                                  total_expenditures,
                                  rowSums(across(c(total, total_current_operating_expenditures,
                                            total_nonoperating_expenditures)),
                                    na.rm = TRUE)),
           .after = year)
  
  if(str_detect(file_path, "200[1-8]")) {
    cleaned_data[, 5:ncol(cleaned_data)] <- cleaned_data[, 5:ncol(cleaned_data)] * 1e6
  }
  
  return(cleaned_data)
}

historic_dat <- process_yearly("Data/Yearly Spending/By-LGU-SRE-2004.xlsx") |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2005.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2006.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2007.xlsx")) |> 
   bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2008.xlsx")) |>
   bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2009.xlsx")) |>
   bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2010.xlsx")) |>
   bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2011.xlsx"))

# Graph Kalahi spending over time by treat and control
historic_dat <-
  read_csv("Data/KALAHI/PHL-KC Matching Data for Sample/matching data for sample.csv") |> 
  rename(region = reg_psgc, treat = treatment) |> 
  select(-c(island, mun_psgc, pairnum)) |> 
  mutate(yolanda = ifelse(mun %in% yolanda, 1, 0)) |> 
  group_by(region, mun) |> 
  filter(n() == 1) |> 
  ungroup() |> 
  full_join(historic_dat, by = c("region", "mun")) |> 
  filter(!is.na(treat) & !is.na(year))

# Evaluating hypothesis that IE was randomized via randomization inference
# Note: Code provided by Graeme Blair

suppressMessages({
  library(DeclareDesign)
  library(lmtest)
  library(ri2)
  library(nnet)
})

set.seed(252463)

balance_vars <- c("kalahi_spending", 
                  "total_spending", 
                  "pi", 
                  "bgytot", 
                  "pop07nso", 
                  "land")

balance_df <- historic_dat %>%
  filter(as.numeric(year) < 2012) |> 
  select(region, province, treat, all_of(balance_vars)) %>% 
  na.omit

declaration <- 
  with(balance_df,{
    declare_ra(
      blocks = region,
      clusters = province,
      conditions = 0:1
    )
  })

# Robust regression function
regression_fun <- function(data) {
   lm_robust(as.formula(paste0("treat ~ as.factor(region) + ", paste0(balance_vars, collapse = "+"))), clusters =
               province, data = data)
  }

balance_fun <- function(data) {
  data %>% regression_fun %>% glance %>% pull(statistic)
  }

ri2_out <-
  conduct_ri(
    test_function = balance_fun,
    declaration = declaration,
    assignment = "treat",
    sharp_hypothesis = 0,
    sims = 100,
    data = balance_df)

ri2_summ <- summary(ri2_out) %>% rename_with(~paste0(., "_F_ri"))

balance_results <- balance_df %>% 
  regression_fun() %>% 
  tidy %>% 
  filter(term %in% balance_vars) %>% 
  bind_cols(ri2_summ)

# Present results
historic_treat <- historic_dat |> filter(treat == 1)
historic_cont <- historic_dat |> filter(treat == 0)

data.frame(
  var = c("kalahi spending", "total spending", "poverty index", "num barangay", "population",
          "land area"),
  mean_treat = c(mean(historic_treat$kalahi_spending / historic_treat$pop07nso),
                 mean(historic_treat$total_spending / historic_treat$pop07nso),
                 mean(historic_treat$pi), mean(historic_treat$bgytot),
                 mean(historic_treat$pop07nso), mean(historic_treat$land)),
  mean_cont = c(mean(historic_cont$kalahi_spending / historic_cont$pop07nso),
                mean(historic_cont$total_spending / historic_cont$pop07nso),
                mean(historic_cont$pi), mean(historic_cont$bgytot),
                 mean(historic_cont$pop07nso), mean(historic_cont$land)),
  sd_treat = c(sd(historic_treat$kalahi_spending / historic_treat$pop07nso),
               sd(historic_treat$total_spending / historic_treat$pop07nso),
               sd(historic_treat$pi), sd(historic_treat$bgytot),
               sd(historic_treat$pop07nso), sd(historic_treat$land)),
  sd_cont = c(sd(historic_cont$kalahi_spending / historic_cont$pop07nso),
              sd(historic_cont$total_spending / historic_cont$pop07nso),
              sd(historic_cont$pi), sd(historic_cont$bgytot),
              sd(historic_cont$pop07nso), sd(historic_cont$land)),
  p = c(balance_results[1,5], balance_results[2,5], balance_results[3,5],
        balance_results[4,5], balance_results[5,5], balance_results[6,5])
) |>
    kable(format = "latex", booktabs = TRUE, digits = 4,
        caption = "Pretreatment covariate balance") |> 
  kable_styling(font_size = 8)

# Get list of budget categories for subsequent random forest analysis
budget_items <- process_quarterly("Data/Quarterly Spending/SRE-QTR-2013.xlsx", sheet = "Q32013") |> 
  select(-c(province, region, mun, quarter, year, kalahi_spending, total_spending)) |> 
  colnames()
```

\clearpage

```{r, echo = FALSE, message = FALSE, warning = FALSE}
historic_dat <- process_yearly("Data/Yearly Spending/By-LGU-SRE-2004.xlsx") |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2005.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2006.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2007.xlsx")) |> 
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2008.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2009.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2010.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2011.xlsx")) |> 
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2012.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2013.xlsx")) |>
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2014.xlsx")) |> 
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2015.xlsx")) |> 
  bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2016.xlsx"))
  # bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2017.xlsx")) |> 
  # bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2018.xlsx")) |> 
  # bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2019.xlsx")) |>
  # bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2020.xlsx")) |> 
  # bind_rows(process_yearly("Data/Yearly Spending/By-LGU-SRE-2021.xlsx"))

historic_dat <-
  read_csv("Data/KALAHI/PHL-KC Matching Data for Sample/matching data for sample.csv") |> 
  rename(region = reg_psgc, treat = treatment) |> 
  select(-c(island, mun_psgc, pairnum)) |> 
  mutate(yolanda = ifelse(mun %in% yolanda, 1, 0)) |> 
  group_by(region, mun) |> 
  filter(n() == 1) |> 
  ungroup() |> 
  full_join(historic_dat, by = c("region", "mun")) |> 
  filter(!is.na(treat) & !is.na(year))

historic_dat |> 
  mutate(
    treat = ifelse(treat == 1, "treat", "control"),
    year_num = as.numeric(year),
    spending = log(kalahi_spending)
  ) |> 
  ggplot(aes(x = year_num, y = I(kalahi_spending / pop07nso), color = treat, fill = treat)) +
  # Confidence interval ribbon
  stat_summary(
    fun.data = mean_se, 
    geom = "ribbon", 
    alpha = 0.2, 
    color = NA
  ) +
  # Mean trend lines
  stat_summary(
    fun = mean, 
    geom = "line", 
    size = 1.2
  ) +
  # Vertical line at impact start
  geom_vline(
    xintercept = 2010, 
    linetype = "dashed", 
    color = "gray40", 
    size = 0.8
  ) +
  # Annotation for vertical line
  annotate(
    "text", x = 2010, y = 225, label = "Kalahi begins", 
    vjust = -0.5, angle = 90, size = 3.5, color = "gray40"
  ) +
  annotate(
    "text", x = 2016, y = 225, label = "Funding ends", 
    vjust = -0.5, angle = 90, size = 3.5, color = "gray40"
  ) +
  labs(
    x = "", 
    y = "Public service spending", 
    title = "Figure 1: Balance on pretreatment spending",
    color = NULL,
    fill = NULL
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")

historic_dat |> 
  mutate(
    treat = ifelse(treat == 1, "treat", "control"),
    year_num = as.numeric(year),
    spending = log(total_spending)
  ) |> 
  ggplot(aes(x = year_num, y = I(total_spending / pop07nso), color = treat, fill = treat)) +
  # Confidence interval ribbon
  stat_summary(
    fun.data = mean_se, 
    geom = "ribbon", 
    alpha = 0.2, 
    color = NA
  ) +
  # Mean trend lines
  stat_summary(
    fun = mean, 
    geom = "line", 
    size = 1.2
  ) +
  # Vertical line at impact start
  geom_vline(
    xintercept = 2010, 
    linetype = "dashed", 
    color = "gray40", 
    size = 0.8
  ) +
  # Annotation for vertical line
  annotate(
    "text", x = 2010, y = 1650, label = "Kalahi begins", 
    vjust = -0.5, angle = 90, size = 3.5, color = "gray40"
  ) +
  annotate(
    "text", x = 2016, y = 1650, label = "Funding ends", 
    vjust = -0.5, angle = 90, size = 3.5, color = "gray40"
  ) +
  labs(
    x = "", 
    y = "Public service spending", 
    title = "Figure 1: Balance on pretreatment spending",
    color = NULL,
    fill = NULL
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

\clearpage

# 4 Results

In order to identify the effect of Kalahi-CIDSS on public spending, I estimate the following equation

$$
y_{it} = \tau D_{i} + \gamma_{i} + \pi_{i} + \lambda_{i} + \rho_{i} + \alpha_{r} + \delta_{t} + \epsilon_{rt}
$$

where $y_{it}$ represents per capita spending for municipality $i$ at quarter $t$ and $\tau$ is a the treatment effect of Kalahi-CIDSS.

On November 8, 2013, nearly one year into grant implementation for the Kalahi-CIDSS impact evaluation, Typhoon Yolanda (international name Haiyan) struck the Philippines. One of the most powerful tropical cyclones ever recorded, Yolanda killed at least 6,300 Filipinos and is estimated to have cost the Philippine government nearly \$13 billion USD (@worldbank). Given the impact on public spending, I code a binary variable that takes the value of $1$ if a municipality received heavy damage from Yolanda and $0$ otherwise, as documented by the Asian Development Bank materials on the impact of Yolanda on Kalahi-CIDSS regions (@asiandevelopmentbank). As the Philippine government continued recovery efforts for many years after Yolanda, I code this variable as $1$ for all years included in the impact evaluation sample. $\gamma_{i}$ measures the effect of this dichotomous variable.

I include a number of additional covariates as well. These include population ($\pi_{i}$), land area ($\lambda_{i}$), and poverty index ($\rho_{i}$). I also include region and quarter fixed effects, represented by the terms $\alpha_{r}$ and $\delta_{t}$, respectively. The error term $\epsilon_{rt}$ is clustered at the region by quarter level. In order to standardize comparison across municipalities of varying sizes, all public spending variables are measured per capita.

Table 2 presents the effect of Kalahi-CIDSS on municipal public service spending. Kalahi reduced public service spending in recipient municipalities, and this result is significant at conventional levels ($p<.001$). Interpretation yields particularly striking results. Kalahi reduced quarterly per capita public service spending by about PhP 248 (roughly \$4). This spending reduction for the median municipal population[^4] amounts to about 28 million pesos yearly, or half a million dollars.

[^4]: The median municipal population in the Kalahi-CIDSS impact evaluation sample is 28,267.

## Crowd-out is not offset by spending increases elsewhere

This reduction is not offset by spending increases elsewhere. Table 2 shows the effect of Kalahi-CIDSS on total per capita spending across the entire municipal budget. Treatment reduced total quarterly per capita spending by about PhP 239, only slightly smaller than the effect estimate for public service spending.

As a placebo test, I also check whether Kalahi-CIDSS reduced spending in unrelated budget categories. Table 2 presents the effect of treatment on financing from the national government, which is exogenous to local decisions and should not be affected by local-level crowd-out. The associated parameter estimate is small and insignificant, which corroborates that the observed spending reduction is indeed driven by crowd-out in response to Kalahi-CIDSS.

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# This constitutes a .16 standard deviation reduction (Cohen's d), or about 2.5% of the mean yearly budget.

lm_kalahi <- lm_robust(kalahi_spending_percap ~ treat + yolanda + I(pop07nso / 1000) + land + pi + bgytot +
                     as.factor(region) + as.factor(quarter), dat)
lm_total <- lm_robust(total_spending_percap ~ treat + yolanda + I(pop07nso / 1000) + pi + land + bgytot +
                     as.factor(region) + as.factor(quarter), dat)
natl_sources <- lm_robust(I(other_shares_from_national_tax_collections / pop07nso) ~ treat + yolanda + I(pop07nso / 1000) + pi + land + bgytot +
                  as.factor(region) + as.factor(quarter) + pi, dat)

modelsummary(list("Public service spending" = lm_kalahi, "Total" = lm_total,
                  "National gov sources" = natl_sources),
             coef_map = c(
               "treat" = "treat",
               "yolanda" = "yolanda",
               "I(pop07nso/1000)" = "population",
               "pi" = "poverty incidence",
               "land" = "land area",
               "bgytot" = "num barangays"
             ),
             stars = T,
             title = "Effect of Kalahi on quarterly public spending",
             output = "kableExtra") |>
  kable_classic(latex_options = "hold_position") |> 
  kable_styling(full_width = FALSE, position = "center") |> 
  footnote(general = "Spending measured in Philippine pesos. Population covariate scaled per 1,000 people
  such that significant digits are visible in the parameter estimate. Models include region and
  quarter-fixed effects.", threeparttable = TRUE, escape = FALSE, footnote_as_chunk = TRUE)
```

## Political competition dampens crowd-out

Now I turn my attention to features that moderate this effect. If aid crowds out public spending in some contexts and not others, what factors drive this variation? Here I present evidence that political competition determines how politicians respond to development assistance.

Figure 2 plots public service and total spending by mayoral margin of victory for treated and control municipalities. Outcomes for each unit are shown alongside LOESS regressions for treatment and control groups. For control municipalities, mayors who won by large margins spent much more than those who did not. However, under treatment, their spending appears to roll back significantly.

\hspace{40 mm}

```{r, echo = FALSE, message = FALSE, warning = FALSE}
descriptive_dat <- dat |> mutate(treat = case_when(
  treat == 1 ~ "treat",
  treat == 0 ~ "control",
  .default = NA
))

ggplot(dat, aes(x = vote_diff, y = kalahi_spending / pop07nso, color = as.factor(treat))) +
  geom_smooth() +
  geom_point(alpha = .15) +
  guides(color = guide_legend(label = FALSE)) +
  labs(x = "", y = "Public service spending", title = "Figure 2: Political competition and
       public spending") +
  theme_minimal() +
  theme(legend.position = "none")

ggplot(descriptive_dat, aes(x = vote_diff, y = total_spending / pop07nso, color = as.factor(treat))) +
  geom_smooth() +
  geom_point(alpha = .15) +
  labs(x = "Margin of victory", y = "Total spending",
       color = "Received Kalahi", title = "",
       caption = "Note: Spending measured quarterly per capita in Philippine pesos") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

In order to investigate this relationship systematically and determine if political competition moderates crowd-out, I interact treatment with margin of victory in the mayoral contest immediately preceding program implementation (2013). As anticipated, I find that municipalities with more competition continue to spend on public services while Kalahi crowds out state spending in less competitive municipalities.

Table 3 presents effects on per capita public spending in Kalahi budget categories, as well as across the total budget. While treatment and vote margin are positively associated with public spending, the interaction effect is negative. Politicians in uncompetitive districts seem to spend more per capita, but those who received Kalahi spent less.

These results are not sensitive to particular measures of electoral competition. For robustness, I code binary variables for low competition that take the value of 1 if the vote margin is greater than 60 and 50 percent, as well as ones for high competition that take the value of 1 if the vote margin is less than 20 and 10 percent. Results from regressions using these interaction terms are also presented in Table 3.

```{r, echo = FALSE, warning = FALSE, message = FALSE}
kalahi_elec <- lm_robust(kalahi_spending_percap ~ treat * vote_diff + yolanda + I(pop07nso / 1000) + pi +
                           land + bgytot + as.factor(region) + as.factor(quarter), dat)
total_elec <- lm_robust(total_spending_percap ~ treat * vote_diff + yolanda + I(pop07nso / 1000) + pi +
                          land + bgytot + as.factor(region) + as.factor(quarter), dat)
kalahi_60 <- lm_robust(kalahi_spending_percap ~ treat * sixtieth_margin + yolanda + I(pop07nso / 1000) + pi +
                         land + bgytot + as.factor(region) + as.factor(quarter), dat)
total_60 <- lm_robust(total_spending_percap ~ treat * sixtieth_margin + yolanda + I(pop07nso / 1000) + pi +
                        land + bgytot + as.factor(region) + as.factor(quarter), dat)
kalahi_50 <- lm_robust(kalahi_spending_percap ~ treat * fiftieth_margin + yolanda + I(pop07nso / 1000) + pi +
                         land + bgytot + as.factor(region) + as.factor(quarter), dat)
total_50 <- lm_robust(total_spending_percap ~ treat * fiftieth_margin + yolanda + I(pop07nso / 1000) + pi +
                        land + bgytot + as.factor(region) + as.factor(quarter), dat)
kalahi_20 <- lm_robust(kalahi_spending_percap ~ treat * twentieth_margin + yolanda + I(pop07nso / 1000) + pi +
                         land + bgytot + as.factor(region) + as.factor(quarter), dat)
total_20 <- lm_robust(total_spending_percap ~ treat * twentieth_margin + yolanda + I(pop07nso / 1000) + pi +
                        land + bgytot + as.factor(region) + as.factor(quarter), dat)
kalahi_10 <- lm_robust(kalahi_spending_percap ~ treat * tenth_margin + yolanda + I(pop07nso / 1000) + pi +
                         land + bgytot + as.factor(region) + as.factor(quarter), dat)
total_10 <- lm_robust(total_spending_percap ~ treat * tenth_margin + yolanda + I(pop07nso / 1000) + pi +
                        land + bgytot + as.factor(region) + as.factor(quarter), dat)

modelsummary(list("Public services" = kalahi_elec,
                  "Total" = total_elec,
                  "Public services" = kalahi_60,
                  "Total" = total_60,
                  "Public services" = kalahi_50,
                  "Total" = total_50,
                  "Public services" = kalahi_20,
                  "Total" = total_20,
                  "Public services" = kalahi_10,
                  "Total" = total_10),
             stars = T,
             title = "Effect of Kalahi on public spending by electoral competitiveness",
             coef_map = c(
               "treat" = "treat",
               "vote_diff" = "margin of victory",
               "treat:vote_diff" = "treat x margin of victory",
               "sixtieth_margin" = "60th margin",
               "treat:sixtieth_margin" = "treat x 60th margin",
               "fiftieth_margin" = "50th margin",
               "treat:fiftieth_margin" = "treat x 50th margin",
               "twentieth_margin" = "20th margin",
               "treat:twentieth_margin" = "treat x 20th margin",
               "tenth_margin" = "10th margin",
               "treat:tenth_margin" = "treat x 10th margin"
             ),
             output = "kableExtra"
             ) |> kable_classic(latex_options = "scale_down") |> 
  kable_styling(full_width = FALSE, position = "center") |> 
  footnote(general = "Spending measured per capita in Philippine pesos.
  Models include region and quarter-level fixed effects, as well as the full range of municipal
  covariates.", threeparttable = TRUE,
  escape = FALSE, footnote_as_chunk = TRUE)
```

\clearpage

## Competition shapes human development outcomes

While fungibility itself presents a concern for development policymakers who wish for aid to finance its intended programs, it does not always harm human development. Governments may allocate freed funds efficiently in order to address pressing domestic needs and optimize resources (@feyzioglu1996), and empirical evidence shows that aid fungibility does not necessarily reduce child mortality, particularly under strong democratic institutions (@pettersson2007). I analyze endline survey data from the Kalahi-CIDSS impact evaluation in order to examine whether crowd-out may have borne consequences for human development.

I present marginal effect estimates across municipal vote margins below for key outcomes of Kalahi-CIDSS. Treatment effects at three different margins of victory (.1, .4, and .7) are shown for comparison. While not every human development outcome from the impact evaluation exhibits heterogeneity, those that do suggest an association between Kalahi and worse development outcomes when political competition is low. In municipalities where the mayor secured more than half of the vote share, household income, household spending, and access to public services tended to be worse in Kalahi-treated areas, suggesting possible adverse associations. The marginal effect of mayoral margin of victory on work hours and school enrollment appears negative as well, although bootstrapped confidence intervals cover zero throughout the range of the moderator. However, agricultural outcomes exhibit a positive trend, with higher crop yields in less competitive municipalities, although the associated confidence intervals do also cross zero.

These results do not demonstrate that crowd-out dampened human development. Political competition is not randomly assigned, high vote margins are not universally associated with worse program outcomes, and there is no evidence to indicate that the mechanism through which political competition shapes human development (if at all) is crowd-out. However, they do warrant inquiry. Kalahi-CIDSS was a non-governmental community development program led entirely by citizen councils external from the government. Kalahi reduced public service spending in the absence of political competition. Given that public investment promotes human development in the Philippines (@lavado2009; @corong2013), it is plausible that crowd-out contributes to these patterns.

Further research should investigate the channels through which political institutions might mediate the effects of non-governmental development programs. While fungibility is a salient concern for aid delivered to governments, it has not yet been investigated in the context of external programming. If crowd-out shapes human development, then it should inform non-governmental development policymaking. Crowd-out also bears implications for evidence-based policymaking and scientific evaluations of development programs. Beneficial programs could yield null results when counteracted by fungibility, or researchers could conclude that a particular intervention harms development when the true effect was positive but government institutions reallocated funds sub-optimally. These risks underscore the importance of considering political and fiscal contexts in evaluation design.

```{r, message = F, warning = F, echo = F, message = F, output = F}
library(haven)
library(interflex)

# Load matching variables for household surveys
interim_details <- read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/Interim Details on Full Sample 198 Sample v5.dta")

# Merge with covariates
analysis_match <- read_csv("Data/KALAHI/PHL-KC Matching Data for Sample/matching data for sample.csv") |>
  rename(region = reg_psgc) |> 
  dplyr::select(-c(island)) |> 
  mutate(yolanda = ifelse(mun %in% yolanda, 1, 0)) |> 
  left_join(interim_details[,-4], by = c("pairnum", "treatment")) |> 
  rename(treat = treatment) |> 
  dplyr::select(-c(treatmen))

# Merge in vote share data
analysis_match <- dat |>
    dplyr::select(c(region, mun, vote_share, vote_diff,
           kalahi_spending_percap, total_spending_percap)) |> 
  distinct(region, mun, .keep_all = T) |> 
  right_join(analysis_match, by = c("region", "mun")) |> 
  mutate(mun = as.factor(mun))

## Read in human welfare data, merge with municipal covariates, and clean
# Hardship
hardship <-
  read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_H8_Hardship_HH_AnalysisVarsB.dta") |>
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  mutate(across(de1_death:DE5_96B, \(x) ifelse(x == -95, NA, x))) |>  # Recode missing vals to NA
  mutate(assistance = rowSums(across(c(de6_death_finass_a, de6_ill_finass_a, de6_job_finass_a, de6_calam_finass_a,
           de6_noharv_finass_a, de6_van_finass_a)), na.rm = T),
         asked_lgu = ifelse((de4_death_helpLguOff == 1) | (de4_illness_helpLguOff == 1) | (de4_jobless_helpLguOff == 1)
                            | (de4_calamity_helpLguOff) == 1 | (de4_noharvest_helpLguOff) == 1 |
                              (de4_vandal_helpLguOff) == 1, 1, 0))

# Fishing
fish <-
  read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_Hypothesis_1c_FA_HH_AnalysisVarsA.dta") |> 
  left_join(analysis_match, by = "lk4") |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  mutate(across(fish1:fyp4p_5, \(x) ifelse(x == -95, NA, x))) |>
  mutate(qty_fish_sold = rowSums(across(matches("fyp4a_[1-9]")), na.rm = T),
         price_fish_sold = rowSums(across(matches("fyp4d_[1-9]")), na.rm = T),
         qty_aquaculture_sold = rowSums(across(matches("fyp4q_[1-9]")), na.rm = T),
         price_aquaculture_sold = rowSums(across(matches("fyp4p_[1-9]")), na.rm = T))

# Agriculture
agri <-
  read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_Hypothesis_1c_Agri_HH_AnalysisVarsA.dta") |> 
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  mutate(across(crop1:ag18a_d22, \(x) ifelse(x == -95, NA, x))) |>
  mutate(area_planted = rowSums(across(matches("ag17a_[1-9]|ag6s_[1-9]|ag17h")), na.rm = T),
         qty_harvest = rowSums(across(matches("ag18a|ag7a")), na.rm = T),
         qty_harvest_sold = rowSums(across(matches("ag19a1_[1-9]")), na.rm = T))

# Employment
labor <- read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_LT2_Labor_HH-AnalysisVarsB.dta") |> 
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  mutate(across(lm2:lm13, \(x) ifelse(x == -95, NA, x))) |> 
  rename(income = lm9, work_hrs = lm11, hrs_worked_last_wk = lm13)

# Spending
spending <- read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_LT1_AnalysisVarsB.dta") |> 
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  mutate(across(fuel1:tobacco_2, \(x) ifelse(x == -95, NA, x))) |>
  mutate(hh_spending = rowSums(across(matches("1$")), na.rm = T),
         hh_produce = rowSums(across(matches("2$")), na.rm = T))

# Education (Null effects)
edu <- read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_Hypothesis_1e_AnalysisVarsB.dta") |> 
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  mutate(num_teachers = rowSums(across(matches("teacher")), na.rm = T),
         num_schools = rowSums(across(c(edf_public_elem, edf_public_sec)), na.rm = T),
         enrollment = rowSums(across(matches("enrolled")), na.rm = T))

# Infrastructure (reverse direction?)
infra <- read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_Hypothesis_1a_AnalysisVarsA.dta") |> 
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  mutate(dist_pub_services = rowSums(across(matches("acs1_m")), na.rm = T),
         travel_time = rowSums(across(matches("acs3")), na.rm = T),
         travel_cost = rowSums(across(matches("acs4")), na.rm = T))
infra2 <- read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_Hypothesis_1b-AnalysisVarsA.dta") |> 
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y"))

# Water (don't use)
water <- read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_Hypothesis_1h_AnalysisVarsA.dta") |> 
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  mutate(across(ws2_d:ws13_r, \(x) ifelse(x == -95, NA, x))) |> 
  mutate(amnt_paid = ws12_r + ws12_d,
         time_spent = ws8_r + ws8_d,
         num_trips = ws9_dt + ws9_rt)

# Household (don't use)
household <- read_dta("Data/KALAHI/Endline Public Use Data Package/Datasets/3rdRnd_LT1_AnalysisVarsC.dta") |> 
  left_join(analysis_match, by = c("lk4")) |> 
  dplyr::select(!matches("\\.x|\\.y")) |> 
  rename(floor_area = ham4_m, num_rooms = ham5, elec = ham7) |> 
  mutate(elec = as.numeric(elec), floor_area = as.numeric(floor_area))

# Visualizing treatment effect heterogeneity across development outcomes
hh_spending <- interflex(
  estimator = "linear",
  data = as.data.frame(spending),
  Y = "hh_spending",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land", "mun", "NumHHMem"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "Household spending",
  xlab = ""
  )

income <- interflex(
  estimator = "linear",
  data = as.data.frame(labor),
  Y = "income",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land", "mun", "rid9_sex"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "Income",
  xlab = ""
  )

work_hrs <- interflex(
  estimator = "linear",
  data = as.data.frame(labor),
  Y = "work_hrs",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land", "mun", "rid9_sex"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "Work hours",
  xlab = ""
  )

dist_pub_services <- interflex(
  estimator = "linear",
  data = as.data.frame(infra),
  Y = "dist_pub_services",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land", "mun"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "Distance to public services",
  xlab = ""
  )

travel_cost <- interflex(
  estimator = "linear",
  data = as.data.frame(infra),
  Y = "travel_cost",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land", "mun"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "Travel cost to public services",
  xlab = ""
  )

travel_time <- interflex(
  estimator = "linear",
  data = as.data.frame(infra),
  Y = "travel_time",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land", "mun"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "Travel time to public services",
  xlab = ""
  )

area_planted <- interflex(
  estimator = "linear",
  data = as.data.frame(agri),
  Y = "area_planted",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land", "mun"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "Area planted",
  xlab = ""
  )

qty_harvest <- interflex(
  estimator = "linear",
  data = as.data.frame(agri),
  Y = "qty_harvest",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land", "mun"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "Qty harvest",
  xlab = ""
  )

enrollment <- interflex(
  estimator = "linear",
  data = as.data.frame(edu),
  Y = "enrollment",
  D = "treat",
  X = "vote_diff",
  Z = c("pop07nso", "yolanda", "pi", "land"),
  diff.values = c(.1, .4, .7),
  na.rm = T,
  ylab = "School enrollment",
  xlab = ""
  )
```

```{r, warning = F, message = F, echo = F, fig.width=15, fig.height=12, fig.align='center'}
library(patchwork)

(hh_spending$figure | income$figure | work_hrs$figure) / 
  (dist_pub_services$figure | travel_cost$figure | travel_time$figure) /
  (area_planted$figure | qty_harvest$figure | enrollment$figure) +
  plot_annotation(
    title = "Figure 3: Human development by vote margin",
    caption = "Spending measured in Philippine pesos and distance measured in meters",
    theme = theme(plot.title = element_text(size = 30, hjust = 0.5), plot.caption = element_text(size = 20))
  )
```

## Development programs affect broader budget allocation

Does foreign aid merely reduce public service provision, or do politicians redistribute funds to other portions of the budget? If so, how are funds reallocated? I now turn my attention to this question, exploring whether and how Kalahi-CIDSS impacted broader quarterly budget allocation.

I exploit supervised machine learning in order to determine whether Kalahi-CIDSS bore additional effects on public spending. I fit nested models to predict treatment trained on Kalahi-related budget categories as well as the whole budget and compare model fit. The logic behind this approach is simple. If politicians reduced public service provision while spending identically everywhere else, then the remaining budget variables should be unrelated to treatment, and a model trained on the full budget should predict treatment no better than a model trained only on Kalahi-related budget categories. If additional features of the budget hold explanatory power, then treatment likely had effects beyond substituting for Kalahi-related line items.

Model fit is relatively straightforward to compare for categorical supervised learning models. The out-of-bag (OOB) error rate provides of measure of model performance on data outside of the training set. The random forest algorithm, which I employ here, randomly samples a subset of the data from which to build a decision tree, then predicts the outcome for excluded observations (@breiman2001). Many such trees are built when fitting a random forest (the exact number set by the programmer), and final predictions are determined for each observation by aggregating among the decisions from trees in which it was excluded from the training set. The out of bag error rate is thus the rate of unsuccessful classification from these final predictions.

However, given that random forests randomly sample the data at each split, decision trees and their predictions can vary each time a model is fit, and thus the out of bag error rate can vary as well (although often only slightly). In order to evaluate whether model fit improves significantly when trained on the full budget and not just because a particular model happened to have an unlikely small error rate, I fit 100 limited and 100 full random forests of each model type. This bootstrap approach allows me to sample from the distribution of possible error rates and compare them statistically via a t-test.

In order to falsify this approach, I also fit random forests to predict my binary indicator for heavy damage from Yolanda from the full budget. Given that Yolanda significantly impacted public spending, if a random forest cannot sufficiently predict heavy damage, then it is unlikely that it can predict a municipality receiving Kalahi-CIDSS. As a placebo test, I code a binary random variable and fit random forests to predict it as well from the municipal budget data. As this random variable is entirely unrelated to how politicians allocate their financial resources, municipal budgets should not be predictive.

Figure 4 displays the average out of bag error rates across each model type in comparison to the expected rate obtained via random guessing (.5). I find that models trained on the complete budget have significantly lower error than those fit on Kalahi line items alone. Additionally, a random forest is able to predict heavy damage from Yolanda significantly better than random guessing, and random forest is unable to predict a random variable much better than random guessing.

\hspace{40 mm}

```{r, echo = FALSE, message = FALSE, warning = FALSE, results = 'hide', eval = FALSE}
# Compare model fit to explore effects of treatment on budget

set.seed(252463)

# Code a random variable
dat <- dat |> mutate(random = sample(c(0, 1), nrow(dat), replace = TRUE))

# Fit many random forests on limited vs full budget and compare model fit
grow_forest <- function() {
  
  # Remove all other covariates from budget data and impute missing values
  trimmed <- dat |> filter(is.na(treat) == FALSE) |> select(append(budget_items, c("treat", "yolanda", "random")))
  imputed <- rfImpute(treat ~ ., data = trimmed)

  # Fit models to see if can predict treatment or covariates from budget
  kalahi_forest <- randomForest(as.factor(treat) ~ education_culture_sports_manpower_development +
                                  health_nutrition_population_control + housing_and_community_development
                                + social_services_and_social_welfare,
                       data = imputed |> select(!c(yolanda, random)))
  full_forest <- randomForest(as.factor(treat) ~ ., data = imputed |> select(!c(yolanda, random)))
  yolanda_forest <- randomForest(as.factor(yolanda) ~ ., data = imputed |> select(!c(treat, random)))
  random_forest <- randomForest(as.factor(random) ~ ., data = imputed |> select(!c(treat, yolanda)))
  
  # Return df of OOB error rates
  return(data.frame(
    kalahi = as.numeric(kalahi_forest$err.rate[nrow(kalahi_forest$err.rate), "OOB"][1]),
    full = as.numeric(full_forest$err.rate[nrow(full_forest$err.rate), "OOB"][1]),
    yolanda = as.numeric(yolanda_forest$err.rate[nrow(yolanda_forest$err.rate), "OOB"][1]),
    random = as.numeric(random_forest$err.rate[nrow(random_forest$err.rate), "OOB"][1])))
}

# Make many forests
res <- map_dfr(1:100, ~ grow_forest())
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Read in res from machine
res <- read_csv("Data/res.csv")

# Comparing OOB error rate graphically
data.frame(
  model = c("random", "kalahi", "full", "yolanda"),
  error = c(mean(res$random), mean(res$kalahi), mean(res$full), mean(res$yolanda)),
  low = c(mean(res$random) - 1.96*sd(res$random)/length(res$random),
          mean(res$kalahi) - 1.96*sd(res$kalahi)/length(res$kalahi),
          mean(res$full) - 1.96*sd(res$full)/length(res$full),
          mean(res$yolanda) - 1.96*sd(res$yolanda)/length(res$yolanda)),
  high = c(mean(res$random) + 1.96*sd(res$random)/length(res$random),
           mean(res$kalahi) + 1.96*sd(res$kalahi)/length(res$kalahi),
           mean(res$full) + 1.96*sd(res$full)/length(res$full),
           mean(res$yolanda) + 1.96*sd(res$yolanda)/length(res$yolanda))
) |> ggplot(aes(x = reorder(model, -error), y = error)) +
  geom_point() +
  geom_hline(yintercept = .5, linetype = "dashed") +
  labs(title = "Figure 4: Out of bag error rate across 100 models", x = "Model", y = "Error") +
  geom_errorbar(aes(ymin = low, ymax = high), width = 0.03) +
  theme_minimal()
```

\hspace{40 mm}

T-test results are presented in Table 4. I find that the models trained on the full budget are significantly more predictive of treatment than those trained on the limited budget with only Kalahi-related categories. Additionally, random forests can predict heavy damage from Yolanda from municipal budget data better than random guessing, and they perform the worst when attempting to predict a random exogenous variable, increasing confidence in the approach. Kalahi-CIDSS seems to have impacted municipal spending beyond crowding out public services.

\clearpage

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Comparing out of bag error rates statistically
library(scales)

data.frame(
  Models = c("Yolanda vs random guessing", "Kalahi vs random guessing", "Kalahi vs full"),
  p = c(scientific(t.test(res$yolanda, rep(.5, length(res$yolanda)))$p.value, digits = 4),
        scientific(t.test(res$kalahi, rep(.5, length(res$kalahi)))$p.value, digits = 4),
        scientific(t.test(res$full, res$kahali)$p.value, digits = 4))) |>
  kable(format = "latex", booktabs = TRUE, digits = 4,
        caption = "Comparison of model fit") |> 
  kable_styling(font_size = 8)
```

## Funds may be redirected to political supporters

Kalahi shifted broader fund allocation beyond public service provision. This raises questions about whether—and how—politicians may reallocate resources that are freed up by development programs. While causal motives cannot be confirmed in this analysis, exploratory data can offer clues. I again exploit supervised learning to explore this question, producing variable-specific model performance measures in order to identify the features that are most predictive of treatment.

Mean decrease accuracy measures variable performance in a random forest. More specifically, it describes how accuracy drops when the variable is removed from the model, computed using out of bag data (@breiman2001). Higher mean decrease accuracy indicates that a given variable is more important to model prediction. Although mean decrease accuracy scores alone are difficult to interpret, they offer a sense of the ordinal predictive importance of each variable relative to others. While these results are not a formal hypothesis test and should not be interpreted causally, mean decrease accuracy provides an exploratory indication of how Kalahi is associated with municipal budget allocation that can help guide further, more rigorous inquiry.

Table 5 presents a ranking of each municipal budget variable by descending mean decrease accuracy. One of the most predictive budget categories is housing and community development, for which Kalahi-CIDSS provided funds. Taxes are also significantly predictive of treatment. Three of the ten variables with highest mean decrease accuracy measure taxes. These include business taxes, other taxes, and total tax revenue. This is consistent with formal political economy models that argue that fungible aid lowers the tax burden (@pack1993).

Discretionary budget categories also rank highly in mean decrease accuracy. Four of the ten most predictive budget categories contain the word "other" or "general". These lump sum appropriations bear a lower regulatory burden, as they do not need to be itemized and are unspecified until mid-year reallocation. They afford particularly weak accountability mechanisms and have been thought to drive corruption in the Philippines (@yilmaz2013).

To further probe the mechanism behind reallocated funds, I evaluate data from the Philippine Labor Force Survey (LFS) that measure employment statistics across the country. While patronage cannot be directly observed, state employment is frequently used by politicians to reward political allies and maintain power (@robinson2013). The size of the public sector is associated with clientelism, and short term and contractual employment are particularly indicative of patronage appointments (@mccoy2009; @gimpelson2002; @colonnelli2020). If politicians redirect funds freed up by Kalahi to political supporters, we should observe an increase in short term government employment in recipient municipalities.

I exploit data from the Philippine Labor Force Survey (LFS) to test this hypothesis. Fielded quarterly, the LFS gathers data on economic activity in the Philippines, including employment. Respondents provide information about the sector in which they are employed (public or private) as well as the nature of their employment (contractual or salaried). I isolate respondents from municipalities included in the Kalahi impact evaluation sample surveyed during program implementation, yielding 25,453 observations. I code a binary variable indicating whether a respondent reports contractual government employment and run a logistic regression of this outcome on treatment, including the municipal-level covariates from my analyses of crowd-out as well as respondent age and gender from the LFS.

Results are presented in Table 6. Kalahi-CIDSS dramatically increased the log-odds of short term government employment (significant at $p<.01$). Specifically, individuals in treated municipalities had about 72 times higher odds of casual government employment compared to those in control municipalities. While this does not necessarily confirm that these appointments were patronage-driven, which would require individual-level administrative hiring data, it suggests a pattern that warrants further investigation.

I also estimate the effect of Kalahi on total tax revenue, reported in quarterly budgets. Kalahi significantly reduced local tax collection ($p<.01$), supporting past evidence that fungible aid substitutes for taxes.

Additional research should investigate the relationship between development programs and public resource allocation more rigorously. Patronage appointments are not the only perverse political incentive that development programs could ostensibly induce. In addition to bloating the public bureaucracy, development programs could free up funds to be corrupted. Given that discretionary windfalls from the national government are corrupted by local politicians in the Philippines (@batalla2020), it is plausible that fungible non-governmental aid is redirected into politicians' pockets. While corruption is outside of the scope of this study, it presents a salient concern for future research.

```{r, echo = FALSE, message = FALSE, warning = FALSE, results = "hide"}
set.seed(252463)

trimmed <- dat |> filter(is.na(treat) == FALSE) |>
                              select(append(budget_items, c("treat")))
imputed <- rfImpute(treat ~ ., data = trimmed)

# Fit model to predict treatment from budget
full_forest <- randomForest(as.factor(treat) ~ .,
                            data = imputed,
                            importance = TRUE)
```

```{r,echo = FALSE, message = FALSE, warning = FALSE}
as.data.frame(importance(full_forest)) |> 
  rownames_to_column(var = "var") |>
  select(var, MeanDecreaseAccuracy) |> 
  arrange(desc(MeanDecreaseAccuracy)) |> 
  kable(format = "latex", booktabs = TRUE,
        col.names = c("Category", "Mean Decrease Accuracy"),
        caption = "Predictive importance of budget categories") |> 
  kable_styling(latex_options = "scale_down")
```

\clearpage

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# Can be adjusted to use original matching dat

library(fuzzyjoin)
lfs_match <- read_csv("Data/KALAHI/PHL-KC Matching Data for Sample/matching data for sample.csv") |> 
  rename(region = reg_psgc, treat = treatment) |> 
  dplyr::select(island, region, mun, treat, pi, bgytot, pop07nso, land, mun_psgc) |> 
  mutate(mun = case_when(
    mun == "Villa Viciosa" ~ "Villaviciosa",
    mun == "Catarman (CAPITAL)" ~ "Catarman",
    mun == "General Macarthur" ~ "General MacArthur",
    mun == "Macarthur" ~ "MacArthur",
    mun == "Brooke's point" ~ "Brooke's Point",
    mun == "El Nido (Bacuit)" ~ "El Nido",
    mun == "Romblon (CAPITAL)" ~ "Romblon",
    mun == "Lau-an" ~ "Lau An",
    mun == "Tobias Fornier (Dao)" ~ "Tobias Fornier",
    mun == "Ipil (CAPITAL)" ~ "Ipil",
    mun == "Roseller Lim" ~ "R. T. Lim",
    mun == "Licuan-Baay (Licuan)" ~ "Baay Licuan",
    mun == "Asuncion (Saug)" ~ "Asuncion",
    mun == "Lambayong (Mariano Marcos)" ~ "Lambayang",
    mun == "Santa monica (Sapao)" ~ "Santa Monica",
    mun == "San Francisco (Anao-aon)" ~ "San Francisco",
    mun == "Lau-an" ~ "Lau An",
    mun == "Anini-y" ~ "Anini Y",
    .default = mun)) |> 
  arrange(region, mun)

# Merge LFS with covariates and add covariates
lfs <- list.files("Data/Labor Force Surveys") |> 
  map_df(\(x) read_csv(paste0("Data/Labor Force Surveys/", x),
                       col_types = cols(.default = col_character()))) |> 
  mutate(PSU = paste0(REG, PSU)) |> 
  rename(mun_psgc = PSU) |> 
  regex_left_join(lfs_match, by = c("mun_psgc")) |> 
  filter(!is.na(treat)) |> 
  dplyr::select(!matches("\\.x|\\.y")) |>
  mutate(gov_sector = ifelse(C19PCLAS == "2" | J04_OCLS == "2", 1, 0),
         short_term = ifelse(C20_NTEM == "2", 1, 0),
         gov_short_term = ifelse(gov_sector == 1 & short_term == 1, 1, 0)) |>
  mutate(quarter = case_when(
    SVYMO == "01" ~ "Q1",
    SVYMO == "04" ~ "Q2",
    SVYMO == "07" ~ "Q3",
    SVYMO == "10" ~ "Q4"
  )) |> 
  mutate(quarter = paste0(quarter, SVYYR)) |> 
  mutate(work_hrs_last_wk = as.numeric(C22_PHRS))
  

# Merge in vote share data
lfs <- dat |>
  right_join(lfs, by = c("region", "mun", "quarter")) |> 
  rename(treat = treat.x, pop07nso = pop07nso.x, bgytot = bgytot.x, pi = pi.x, land = land.x) |> 
  dplyr::select(!matches("\\.x|\\.y"))

# Run and output glm
casual_gov <- glm(gov_sector ~ treat + as.factor(C06_SEX) + as.numeric(C07_AGE) + pi + I(pop07nso / 1000) + pi +
                    land + bgytot + as.factor(region) + as.factor(quarter), data = lfs, family = "binomial")
casual <- glm(short_term ~ treat + as.factor(C06_SEX) + as.numeric(C07_AGE) + pi + I(pop07nso / 1000) + pi +
                    land + bgytot + as.factor(mun) + as.factor(quarter), data = lfs, family = "binomial")
taxes <- lm_robust(I(total_tax_revenue / pop07nso) ~ treat * tenth_margin + yolanda + I(pop07nso / 1000) + pi +
                        land + bgytot + as.factor(region) + as.factor(quarter), dat)

modelsummary(list("Short term gov employment" = casual,
                  "Tax revenue" = taxes),
             stars = T,
             coef_map = c(
               "treat" = "treat",
               "vote_diff" = "margin of victory",
               "treat:vote_diff" = "treat x margin of victory",
               "as.factor(C06_SEX)2" = "female",
               "as.numeric(C07_AGE)" = "age",
               "I(pop07nso/1000)" = "population",
               "pi" = "poverty incidence",
               "land" = "land area",
               "bgytot" = "num barangays"
             ),
             title = "Effect of Kalahi on taxes and short term government employment",
             output = "kableExtra"
             ) |> kable_classic(latex_options = "hold_position") |> 
  kable_styling(full_width = FALSE, position = "center") |> 
  footnote(general = "Population covariate scaled per 1,000 people such that significant digits are visible in the parameter estimate. Model includes region and quarter-fixed effects.", threeparttable = TRUE, escape = FALSE, footnote_as_chunk = TRUE)
```

\clearpage

<!-- ## Spillovers -->

```{r, echo = FALSE, message = FALSE, eval = FALSE}
library(sf)

# Read shape file of municipalities
sf <- st_read("Data/Municities/MuniCities.shp") |>
  rename(mun = NAME_2) |> 
  group_by(mun) |> 
  filter(n() == 1) |> 
  ungroup()

# Merge w budget data
dat_sf <- dat |> left_join(sf) |> st_as_sf()
adj_matrix <- st_touches(dat_sf, dat_sf)

bordering_control <- sapply(adj_matrix, function(neighbors) {
  any(dat_sf$treat[neighbors] == 1)  # Check if any neighboring municipality is treatment
})

dat_sf <- dat_sf |> 
  mutate(border_treat = ifelse(treat == 0 & bordering_control, 1, 0), .before = pi)

# Re-run analysis accounting for spillovers
kalahi_elec_spill <- lm_robust(I(kalahi_spending / pop07nso) ~ treat + border_treat + vote_diff +
                  I(treat * vote_diff) + yolanda + I(pop07nso / 1000) +
                  as.factor(mun) + as.factor(quarter) + pi, dat_sf)
total_elec_spill <- lm_robust(I(total_spending / pop07nso) ~ treat + border_treat + vote_diff +
              I(treat * vote_diff) + yolanda + I(pop07nso / 1000) + as.factor(mun)
            + as.factor(quarter) + pi, dat_sf)

modelsummary(list("Public services" = kalahi_elec_spill,
                  "Total" = total_elec_spill),
             stars = T,
             title = "Effect of Kalahi on public spending with spillovers",
             output = "kableExtra"
             ) |> kable_classic(latex_options = "scale_down") |> 
  kable_styling(full_width = FALSE, position = "center") |> 
  footnote(general = "Spending measured per capita in Philippine pesos. Population covariate
  scaled per 1,000 people such that significant digits are visible in the parameter estimate.
  Models include region and quarter-level fixed effects.", threeparttable = TRUE,
  escape = FALSE, footnote_as_chunk = TRUE)
```

```{r, echo = FALSE, message = FALSE, eval = FALSE}
# Read in WB proj data, identify those w/o disbursements, and merge w locations
loc <- read_csv("Data/WorldBank_GeocodedResearchRelease_Level1_v1.4.2/data/locations.csv")
wb <- read_csv("Data/WorldBank_GeocodedResearchRelease_Level1_v1.4.2/data/projects_ancillary.csv") |> 
  rename(project_id = `PROJECT ID`) |> 
  filter(COUNTRY == "Philippines") |> 
  #filter(`DISBURSED AMOUNT 1` == 0) |> 
  left_join(loc, by = c("project_id")) |> 
  filter(!is.na(latitude) & !is.na(longitude)) |> 
  filter(grepl("Regional Infrastructure for Growth", `PROJECT NAME`))
  #mutate(approv_date = as.numeric(str_match(`APPROVAL DATE`, "([1-2][0-9][0-9][0-9])")[,2])) |> 
  #filter(approv_date > 2011)

# Convert to sf object with point geometry
wb <- st_as_sf(
  wb,
  coords = c("longitude", "latitude"),
  crs = 4326  # WGS84 coordinate system
)

# Merge w budget shape file & create binary indicator for receiving a project
dat_wb <- st_join(dat_sf, wb, left = TRUE) |> 
  mutate(wb_proj = ifelse(!is.na(project_id), 1, 0))

# Run regression
wb_proj_total <- lm_robust(I(total_spending / pop07nso) ~ wb_proj
                             + I(pop07nso / 1000) + pi + land + bgytot +
                 as.factor(mun) + as.factor(quarter), dat_wb)

modelsummary(list("Total" = wb_proj_total),
             stars = T,
             title = "Effect of Kalahi on unrelated budget categories",
             output = "kableExtra"
             ) |> kable_classic(latex_options = "scale_down") |> 
  kable_styling(full_width = FALSE, position = "center") |> 
  footnote(general = "Spending measured per capita in Philippine pesos. Population covariate
  scaled per 1,000 people such that significant digits are visible in the parameter estimate.
  Models include region and quarter-level fixed effects.", threeparttable = TRUE,
  escape = FALSE, footnote_as_chunk = TRUE)

summary(lm_robust(kalahi_spending_percap ~ treat + non_complier + yolanda + I(pop07nso / 1000) + land + pi + bgytot +
                     as.factor(mun) + as.factor(quarter), t))
```

<!-- ## Other heterogeneous effects -->

<!-- ### Dynasties -->

```{r, eval = FALSE, include = FALSE}
# Read in and merge dynasty data
dynasties <- read_excel("Data/ASoG-POLITICAL-DYNASTIES-DATASET-V2016.xlsx", sheet = "Data") |> 
  rename(mun = Municipality.City, first_name = 'First Name', last_name = 'Last Name') |> 
  mutate(mun = str_to_title(mun)) |> 
  filter(Year == 2013) |> 
  select(first_name, last_name, fat) |> 
  right_join(dat |> mutate(last_name = str_match(winner, "^([^,]+),")[,2],
                           first_name = str_match(winner, ",\\s(.*?)\\s\\(")[,2]),
             by = c("last_name", "first_name")) |> 
  select(-c(first_name, last_name))

# Re-run analysis accounting for dynasties
kalahi_elec_dynasty <- lm_robust(I(kalahi_spending / pop07nso) ~ treat + fat + vote_diff + I(treat * vote_diff) +
                as.factor(region) + as.factor(quarter) + yolanda + I(pop07nso / 1000) + pi + land + bgytot, dynasties)
total_elec_dynasty <- lm_robust(I(total_spending / pop07nso) ~ treat + fat + vote_diff +
              I(treat * vote_diff) + yolanda + I(pop07nso / 1000) + pi + land + bgytot +
                + as.factor(region) + as.factor(quarter), dynasties)

modelsummary(list("Public services" = kalahi_elec_dynasty,
                  "Total" = total_elec_dynasty),
             stars = T,
             title = "Comparative effects of political competition and dynasties",
             #coef_omit = -c(1, 2, 3, 4, 5, 6, 21, 22, 23, 24, 25),
             #coef_rename = c("Intercept", "treat", "vote margin", "treat * vote margin", "yolanda",
                            #"population", "poverty index", "20th vote margin",
                            #"treat * 20th vote margin", "15th vote margin", "treat * 15th vote margin"),
             output = "kableExtra"
             ) |> kable_classic(latex_options = "scale_down") |> 
  kable_styling(full_width = FALSE, position = "center") |> 
  footnote(general = "Spending measured per capita in Philippine pesos. Population covariate
  scaled per 1,000 people such that significant digits are visible in the parameter estimate.
  Models include region and quarter-level fixed effects.", threeparttable = TRUE,
  escape = FALSE, footnote_as_chunk = TRUE)
```

<!-- ### Poverty -->

```{r, echo = FALSE, message = FALSE, eval = FALSE}
# Re-run analysis accounting for pi
kalahi_elec_pi <- lm_robust(I(kalahi_spending / pop07nso) ~ treat + vote_diff +
                  I(treat * vote_diff) + I(treat * pi) + yolanda + I(pop07nso / 1000) +
                  as.factor(mun) + as.factor(quarter) + pi, dat)
total_elec_pi <- lm_robust(I(total_spending / pop07nso) ~ treat + vote_diff +
              I(treat * vote_diff) + I(treat * pi) + yolanda + I(pop07nso / 1000) + as.factor(mun)
            + as.factor(quarter) + pi, dat)

modelsummary(list("Public services" = kalahi_elec_pi,
                  "Total" = total_elec_pi),
             stars = T,
             title = "Comparative effects of political competition and dynasties",
             output = "kableExtra"
             ) |> kable_classic(latex_options = "scale_down") |> 
  kable_styling(full_width = FALSE, position = "center") |> 
  footnote(general = "Spending measured per capita in Philippine pesos. Population covariate
  scaled per 1,000 people such that significant digits are visible in the parameter estimate.
  Models include region and quarter-level fixed effects.", threeparttable = TRUE,
  escape = FALSE, footnote_as_chunk = TRUE)
```

# 5 Conclusion

Aid has long been theorized to crowd out government spending, substituting for local revenue and rendering some portion of fungible funds lost to reallocation. The empirical picture, however, is muddied, with a broad array of studies documenting both crowd-out and crowd-in effects. In this paper, I have extended the theoretical model for substitution and argued that non-governmental development programs also substitute for public spending, affording an opportunity to shirk. Furthermore, I demonstrate that political context moderates crowd-out and that electoral competition drives politicians to maintain public service provision.

Leveraging a randomized evaluation of a World Bank community development program in the Philippines, I substantiate these intuitions empirically, finding that the grant substituted for municipal government spending and that this effect appears moderated by margin of victory. Mayors who won by a tighter margin tended to maintain public service provision.

I show that political institutions shape the budgetary incentives that politicians face, and in so doing help to clarify a conflicting literature. In this paper, I extend our understanding of crowd-out and ask not only \textit{if} aid substitutes for public spending but \textit{under what conditions}. In analyzing outcomes from a randomized development program, I offer some of the most credible causal estimates of crowd-out as well.

The case of Kalahi-CIDSS offers a cautionary tale to policymakers. While the program delivered positive community-level benefits, it also highlights unintended consequences for public spending and, possibly, human development outcomes in certain political contexts. Although conventional wisdom suggests that pursuing independent development programs and channeling valuable aid to citizens outside of public pathways can avoid misallocation, these programs create perverse political incentives. Foreign aid substitutes for government spending whether or not politicians actually receive the windfall. Understanding these consequences and the mechanisms that drive them can help to design superior development programs that maximize human development outcomes and promote good governance.

\clearpage

# References

```{r, include = F, eval = F}
## Placebo tests
# Not sig: issuance_of_bonds, net_operating_income_loss_from_current_operations, total_nontax_revenue,
# proceeds_from_sale_of_assets

placebo_elec <- lm_robust(I(general_fund / pop07nso) ~ treat + vote_diff +
                  I(treat * vote_diff) + yolanda + I(pop07nso / 1000) +
                  as.factor(region) + as.factor(quarter) + pi, dat)
placebo_20 <- lm_robust(I(general_fund / pop07nso) ~ treat + twentieth_margin +
                  I(treat * twentieth_margin) + yolanda + I(pop07nso / 1000) +
                  as.factor(region) + as.factor(quarter) + pi, dat)
placebo_15 <- lm_robust(I(general_fund / pop07nso) ~ treat + fifteenth_margin +
                  I(treat * fifteenth_margin) + yolanda + I(pop07nso / 1000) +
                  as.factor(region) + as.factor(quarter) + pi, dat)

modelsummary(list("Public services" = placebo_elec,
                  "Public services" = placebo_20,
                  "Public services" = placebo_15),
             stars = T,
             title = "Effect of Kalahi on public spending by electoral competitiveness",
             #coef_omit = -c(1, 2, 3, 4, 5, 6, 21, 22, 23, 24, 25),
             #coef_rename = c("Intercept", "treat", "vote margin", "treat * vote margin", "yolanda",
                            #"population", "poverty index", "20th vote margin",
                            #"treat * 20th vote margin", "15th vote margin", "treat * 15th vote margin"),
             output = "kableExtra"
             ) |> kable_classic(latex_options = "scale_down") |> 
  kable_styling(full_width = FALSE, position = "center") |> 
  footnote(general = "Spending measured per capita in Philippine pesos. Population covariate
  scaled per 1,000 people such that significant digits are visible in the parameter estimate.
  Models include region and quarter-level fixed effects.", threeparttable = TRUE,
  escape = FALSE, footnote_as_chunk = TRUE)
```
